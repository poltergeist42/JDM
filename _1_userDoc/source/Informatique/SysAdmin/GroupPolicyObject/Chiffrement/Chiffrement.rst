===============
GPO Chiffrement
===============

.. index::
   single: Chiffrement
   single: Bitlocker; Chiffrement

.. contents::
    :depth: 3
    :backlinks: top

####

----------------------------------------------------
STORE BITLOCKER RECOVERY KEYS USING ACTIVE DIRECTORY
----------------------------------------------------

    .. note:: 
        
        **Liens Web**

            * `STORE BITLOCKER RECOVERY KEYS USING AD`_

.. _`STORE BITLOCKER RECOVERY KEYS USING AD`: https://theitbros.com/config-active-directory-store-bitlocker-recovery-keys/


    .. warning:: 
        
        **Scope**

            * At least the version of Active Directory must be on Windows 2012 server.
            * Bitlocker works with Windows 10 and 11 Pro, Education, and Enterprise.

In short
========

This is a cookbook to create a GPO that will store a copy of the cipher's key generated by
Bitlocker into the computer's settings of Active directory.

Setting the GPO
===============

    #. Create a new GPO for computer.

    #. Edit the new GPO.

        .. note:: 
            
            **Arborescence for Bitlocker**
    
            Computer Configuration --> Policies --> Administrative Templates --> Windows Components
            --> Bitlocker Drive Encryption

            .. image:: images/gpoBitlockerArbo.png
                :width: 500 px
                :align: center

    #. Double-click on **"Store BitLocker Recovery information in Active Directory Domain Services"**.

    #. Enable and configure the GPO.

        .. note:: 
            
            **Enable the following option to store the recovery information in Active Directory**
            
            * Select the radio button "Enabled"
            * Tick the checkbox "Require Bitlocker backup to AD DS"
            * Select "Recovery passwords an key packages"
    

            .. image:: images/gpoBitlockerKey2AD.png
               :width: 500 px
               :align: center


            * Clic on the button "OK"

    #. Allow to enable Bitlocker on a computer only of the recovery information are stored in the AD.

        This GPO exist in the three context :

            * Fixed Data Drives
            * Operating System Drives
            * Removable Data Drives

        We must enable this GPO at least on the Operating System Drives. If computers have more than
        one disk, we need to also enable the GPO for Fixed Data Drives. Removable Data Drives can be
        mange manually.

        Inside one the Three folder (for exemple "Operating System Drives"), double-click on 
        **"Choose how BitLocker-protected system drives can be recovered”**.

            .. note:: 
                
                **Enable the following option to allow Bitlocker to be enable or not**
                
                Computer Configuration --> Policies --> Administrative Templates
                --> Windows Components --> Bitlocker Drive Encryption --> Operating System Drives

                * Select the radio button "Enabled"
                * Tick the checkbox 
                    + "Allow data recovery agent"
                    + "Save Bitlocker recovery information to AD DS for Operating system drives"
                    + "Do not enable Bitlocker until recovery information is stored to AD DS for 
                      Operating systems drives"

                * Select those elements from the Dropdown menu
                    + "Allow 48-digit recovery password"
                    + "Allow 256-bit" recovery key"
                    + Store recovery password and key packages
        

                .. image:: images/gpoAllowBitlockerIfAD.png
                   :width: 500 px
                   :align: center

                * Clic on the button "OK"

    #. exit the edition mode.

    #. Link the GPO to a computers OU

Enable Bitlocker on a computer without TPM
==========================================

If we try to enable BitLocker on a computer without TPM. We will receive an error message asking for
enabling one more policy.

    .. image:: images/BitlockerNoTPMError.png
       :width: 500 px
       :align: center


    .. note:: 
        
        **Allow Bitlocker without a compatible Trusted Platform Module (TMP)**

        Computer Configuration --> Policies --> Administrative Templates
        --> Windows Components --> Bitlocker Drive Encryption --> Operating System Drives

        * Select the radio button "Enable".
        * Tick the checkbox "Allow Bitlocker without a compatible Trusted Platform Module (TMP)".
        * Select the various options from the the Dropdowns menus.

        .. image:: images/gpoBitlockerAskMoreAuth.png
           :width: 500 px
           :align: center


Enable AES 256-bit encryption with BitLocker
============================================

    .. note:: 
        
        **Liens Web**

        * `Activer le chiffrement AES 256 bits avec BitLocker`_
    
.. _`Activer le chiffrement AES 256 bits avec BitLocker`: https://www.pcastuces.com/pratique/astuces/4146.htm

By default, BitLocker encrypt data in AES 128 bits. It is possible to improve the security level by
upgrading the encryption from 128 bits to 256 bits.

The Policy **"Choosing Drive Encryption Strength Method"** is provided for three different type of 
OS familly :

    * Windows 8, Windows Server 2012, Windows 8.1, Windows Server 2012r2, Windows 10 (version 1507).
    * Windows 10 version 1511 and above.
    * Windows Vista, Windows Server 2008, Windows 7, Windows Server 2008r2.

The policy can be enabled for all supported version if it is necessary.

    .. note:: 
        
        **Enable AES 256**
        
        Computer Configuration --> Policies --> Administrative Templates
        --> Windows Components --> Bitlocker Drive Encryption 

        * Select the radio button "Enable"
        * Select the "XTS AES 256 bits" method for itch Dropdowns menus

        .. image:: images/gpoAES256.png
           :width: 500 px
           :align: center

Since this policy is a part of BitLocker, it can be set inside the same GPO as the previous one.

Turn On BitLocker Protection on Drives
======================================

    .. note:: 
        
        Open the File Explorer, navigate to **“This PC”**, right-click on the drive, and click 
        **“Turn on BitLocker”**.

        .. image:: images/TurnOnBitlocker.png
           :width: 500 px
           :align: center

Install the Bitlocker Management Tools on the Domaine Controller
================================================================

    .. note:: 
        
        **The BitLocker Management Tools must be installed**
        
        .. code:: powershell
            :number-lines:
            :force:

             Install-WindowsFeature RSAT-Feature-Tools-BitLocker-BdeAducExt

        .. image:: images/BitlockerRsatTool.png
           :width: 500 px
           :align: center

Retrieving BitLocker Recovery Keys
==================================

You can find available recovery keys for each computer on the new tab “BitLocker Recovery”. It is
located in the computer account properties in the Active Directory Users and Computers snap-in.

Using the BitLocker Recovery Tab in the Computer Properties
-----------------------------------------------------------

    .. note:: 
        
        open ADUC, open the computer’s properties, and navigate to the “BitLocker Recovery” tab.
        You’ll see the recovery password that you can provide to the user so they can unlock their
        BitLocker-protected drive.

        .. image:: images/BitlockerRecoveryTab.png
           :width: 500 px
           :align: center

Using the “Find BitLocker recovery password” Tool
-------------------------------------------------

If the user can provide the first eight characters of the BitLocker password ID, you can also use
the Find BitLocker recovery password tool in ADUC.

    .. note:: 
        
        Open ADUC, click Action → Find BitLocker recovery password. Enter the first eight characters
        of the password ID and click **Search**. If the partial password ID is valid, you will see
        the corresponding BitLocker recovery password, as shown below.

        .. image:: images/BitlockerFindeMenu.png
           :width: 500 px
           :align: center

Using PowerShell Script
-----------------------

    .. note:: 
        
        **Liens Web**

        * `Get BitLocker Recovery Password from AD`_
        
.. _`Get BitLocker Recovery Password from AD`: https://gist.github.com/junecastillote/f99805343ec4eeac40b869b62a0d909f

    .. note:: 
        
        This script accepts two parameters: ComputerName and KeyId. You can only **use one parameter
        at a time**.
        
        .. code:: PowerShell
            :number-lines:
            :force:

             # Get-BitLockerRecoveryPassword.ps1


    .. note:: 
        
        **ComputerName**
        
        .. code:: PowerShell
            :number-lines:
            :force:

             .\Get-BitLockerRecoveryPassword.ps1 -ComputerName <COMPUTER NAME>

        .. image:: images/scriptComputerName.png
           :width: 500 px
           :align: center


    .. note:: 
        
        **KeyId**
        
        .. code:: PowerShell
            :number-lines:
            :force:

             .\get-BitLockerRecoveryPassword.ps1 -KeyID <First 8 digit>

        .. image:: images/scriptKeyID.png
           :width: 500 px
           :align: center

####

--------
Weblinks
--------

.. target-notes::